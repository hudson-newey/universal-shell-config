package build

import "usc/config"

func buildWarnings(filePath string) {
	warnings := "# DO NOT EDIT. Configuration generated by usc\n"
	appendToFile(filePath, warnings+"\n")
}

func buildAlias(alias *config.Alias, outDir string) {
	for _, shortHand := range alias.Aliases {
		zshTemplate := "alias " + shortHand + "='" + alias.Command + "'"
		bashTemplate := "alias " + shortHand + "='" + alias.Command + "'"

		powershellTemplate := "function " + shortHand + "-func {\n" +
			"\t" + alias.Command + "\n}\n" +
			"Set-Alias " + shortHand + " " + shortHand + "-func"

		appendToFile(outDir+"/.zshrc", zshTemplate+"\n")
		appendToFile(outDir+"/.bashrc", bashTemplate+"\n")
		appendToFile(outDir+"/Profile.ps1", powershellTemplate+"\n")
	}
}

func buildSource(source *config.Source, outDir string) {
	zshTemplate := "source " + source.Path
	bashTemplate := "source " + source.Path
	powershellTemplate := ". " + source.Path

	appendToFile(outDir+"/.zshrc", zshTemplate+"\n")
	appendToFile(outDir+"/.bashrc", bashTemplate+"\n")
	appendToFile(outDir+"/Profile.ps1", powershellTemplate+"\n")
}

func buildCommand(commands *config.Command, outDir string) {
	zshTemplate := commands.Command
	bashTemplate := commands.Command
	powershellTemplate := commands.Command

	appendToFile(outDir+"/.zshrc", zshTemplate+"\n")
	appendToFile(outDir+"/.bashrc", bashTemplate+"\n")
	appendToFile(outDir+"/Profile.ps1", powershellTemplate+"\n")
}

func BuildTemplate(configuration *config.Config, outDir string) {
	outFiles := []string{".zshrc", ".bashrc", "Profile.ps1"}

	for _, file := range outFiles {
		deleteFile(outDir + "/" + file)
		buildWarnings(outDir + "/" + file)
	}

	aliases := configuration.Aliases
	sources := configuration.Sources
	commands := configuration.Commands

	for _, alias := range aliases {
		buildAlias(alias, outDir)
	}

	for _, source := range sources {
		buildSource(source, outDir)
	}

	for _, command := range commands {
		buildCommand(command, outDir)
	}
}
